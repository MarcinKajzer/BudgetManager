<div [ngClass]="!isExpensesListPopupVisible ? 'hidden' : ''" id="expenses-list-popup" [style]="'left:' + expensesListPopupXOffset + 'px; top:' + expensesListPopupYOffset + 'px'" (click)="showPopup()">
    <div>
        <div *ngFor="let exp of selectedDayExpenses; let i = index">
            <p>{{exp.amount}} PLN - {{exp.comment}} </p>
        </div>
    </div>
</div>

<div [ngClass]="!isEditExpensesPopupVisible ? 'hidden' : ''" id="edit-expenses-popup"  [style]="'left:' + editExpensesPopupXOffset + 'px; top:' + editExpensesPopupYOffset + 'px'" >
    <div>
        <div *ngFor="let exp of selectedDayExpenses; let i = index" class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Kwota" aria-label="Username" [value]="exp.amount" (blur)="updateExpenseAmount($event, exp)">
            <span class="input-group-text">PLN</span>
            <textarea type="text" class="form-control" placeholder="Komentarz" aria-label="Server" [value]="exp.comment" (blur)="updateExpenseComment($event, exp)"></textarea>
            <button class="btn btn-outline-danger"><i class="bi bi-dash"></i></button>
        </div>
        <div class="input-group mb-3">
            <input type="text" class="form-control" placeholder="Kwota" aria-label="Username" (blur)="addExpense($event)" [(ngModel)]="newExpenseAmount">
            <span class="input-group-text">PLN</span>
            <textarea type="text" class="form-control" placeholder="Komentarz" aria-label="Server" [(ngModel)]="newExpenseComment"></textarea>
            <button class="btn btn-outline-danger"><i class="bi bi-dash"></i></button>
        </div>
        <div class="input-group mb-3" *ngIf="newExpenseAmount?.length > 0">
            <input type="text" class="form-control" placeholder="Kwota" aria-label="Username">
            <span class="input-group-text">PLN</span>
            <textarea type="text" class="form-control" placeholder="Komentarz" aria-label="Server"></textarea>
            <button class="btn btn-outline-danger"><i class="bi bi-dash"></i></button>
        </div>
    </div>
</div>

<app-date-selector [year]="selectedYear" [month]="selectedMonth" (selectDate)="changeDate($event)"></app-date-selector>

<div class="table-responsive">
    <table class="table table-bordered">
        <thead class="table-dark">
            <tr>
                <th>Category / day</th>
                <th *ngFor="let day of days">{{day}}</th>
                <th>SUM</th>
            </tr>
        </thead>
        <tbody>
            <ng-container *ngFor="let category of data">
                <tr class='table-secondary fw-bold'>
                    <td class="pt-0 pb-0">{{category.name}}</td>
                    <td class="p-0" *ngFor="let dailyExpense of category.dailyExpenses">
                        <ng-container *ngIf="dailyExpense > 0">
                            {{dailyExpense}}
                        </ng-container>
                    </td>
                    <td class="p-0">{{sum(category.dailyExpenses) > 0 ? sum(category.dailyExpenses) : ''}}</td>
                </tr>
                <tr *ngFor="let subcategory of category.subcategories">
                    <td class="pt-0 pb-0">{{subcategory.name}}</td>
                    <td *ngFor="let dailyExpense of subcategory.dailyExpenses; let i = index" class="p-0 category-day" (click)="showEditExpensesPopup($event, category.id, subcategory.id, i+1)" (mouseover)="showExpensesListPopup($event, category.id, subcategory.id, i+1)">
                        <ng-container *ngIf="dailyExpense > 0">
                            {{dailyExpense}}
                        </ng-container>
                    </td>
                    <td class="p-0 table-warning">{{sum(subcategory.dailyExpenses) > 0 ? sum(subcategory.dailyExpenses) : ''}}</td>
                </tr>
            </ng-container>
            <tr class="table-warning">
                <th class="pt-0 pb-0">SUM</th>
                <th class="p-0" *ngFor="let sum of dailySummary">
                    <ng-container *ngIf="sum > 0">
                        {{sum}}
                    </ng-container>
                </th>
                <th class="p-0 table-danger">{{totalSummary}}</th>
            </tr>
        </tbody>
    </table>
</div>
